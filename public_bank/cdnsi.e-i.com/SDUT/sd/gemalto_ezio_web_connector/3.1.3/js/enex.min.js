/*! cdn_sd_gemalto_ezio_web_connector 2018-01-16 */
var enex=function(){"use strict";function a(){return"3.1.1"}function b(){if(K)return void("function"==typeof K?K().close():K.close());var a=document.getElementById(I);a&&document.body.removeChild(a)}function c(){var a='.enexOverlay {  position: fixed; top: 0; left: 0; right: 0; bottom: 0; background:#333 none repeat scroll 0 0; opacity:0.7; -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=80)"; filter: alpha(opacity=80); }';a+=".enexModalBox { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background:transparent; z-index:10000;-webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; outline: 1px solid #000; }",a+=".enexModalBox > div { opacity: 1; border: solid 8px #FFFFFF; width: 600px; position: relative; margin: 10% auto; text-align: center; padding: 30px; border-radius: 7px; box-shadow: 0 3px 20px rgba(0,0,0,0.9); background: #fff; background: -moz-linear-gradient(#fff, #ccc); background: -webkit-linear-gradient(#ffe, #ccc); background: -o-linear-gradient(#fff, #ccc); text-shadow: 0 1px 0 #fff; }",a+=".enexModalBox p { font-size: 20px; }",a+=".enexModalBox h2 { font-size: 26px; }",a+=".enexModalBox h2:hover { cursor: default; }",a+=".enexModalBox p:hover { cursor: default; }",document.all&&(!document.documentMode||document.documentMode&&document.documentMode<9)?(a+=".enexModalBox a { position: absolute; right: -5px; top: -5px; }",a+=".enexModalBox a { display: block; position: absolute; right: -10px; top: -10px; width: 1.5em; text-decoration: none; text-shadow: none; text-align: center; font-weight: bold; background-color: red; color: #fff; border: 1px solid #fff; }",a+=".enexModalBox a:focus, .enexModalBox a:hover { right: -14px; top: -14px; width: 2.0em; }"):(a+='.enexModalBox a[href="#close"] { position: absolute; right: -5px; top: -5px; color: transparent; }',a+='.enexModalBox a[href="#close"]:focus { outline: none; }',a+='.enexModalBox a[href="#close"]:after { content: "X"; display: block; position: absolute; right: -10px; top: -10px; width: 1.5em; padding: 1px 1px 1px 2px; text-decoration: none; text-shadow: none; text-align: center; font-weight: bold; background: red; color: #fff; border: 3px solid #fff; border-radius: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.5); }',a+='.enexModalBox a[href="#close"]:focus:after, .enexModalBox a[href="#close"]:hover:after { -webkit-transform: scale(1.2,1.2); -moz-transform: scale(1.2,1.2); -ms-transform: scale(1.2,1.2); filter: progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand", M11=1.5320888862379554, M12=-1.2855752193730787, M21=1.2855752193730796, M22=1.5320888862379558); }'),SConnect._createStyleSheet(a)}function d(a){var d,e,f;return b(),K?void("function"==typeof K?K().open(a):K.open(a)):void(!1!==N&&(c(),d=document.createElement("div"),d.id=I,e="ar"===SConnect._localize(),d.dir=e?"rtl":"ltr",f='<div class="enexOverlay"></div>',f+='<div class="enexModalBox">',f+="<div>",f+='<p unselectable="unselectable">'+a+"</p>",f+='<a href="#close" onclick="(function (){ document.body.removeChild(document.getElementById(\''+I+"')); })();\">",f+=document.all&&(!document.documentMode||document.documentMode&&document.documentMode<9)?"x":"",f+="</a>",f+="</div>",f+="</div>",d.innerHTML=f,document.body.appendChild(d)))}function e(a){var b=O[a];return LoggingService.debug("isError - Status Word ("+a+") - Description ("+b+")"),b}function f(a){var b,c,d,e,f,g;if(b=navigator.language?navigator.language.substring(0,2):navigator.browserLanguage.substring(0,2),!a)return b;for(c=0,d=-1,e=0;e<M.length;e+=1)if(M[e]===L&&(c=e),M[e]===b){d=e;break}if(-1===d&&(d=c),f=[],R[a])return R[a][d];for(g in R)R.hasOwnProperty(g)&&-1!==g.indexOf(a)&&f.push(R[g][d]);return 1===f.length?f.toString():f}function g(a,b){var c="EnexException";throw a&&(c+=" - ",c+=a),b&&(c+=" - ",c+=b),LoggingService.error(c),{name:"EnexException",message:a,errorCode:b}}function h(a){(null===a||void 0===a||void 0===a.success||void 0===a.failure)&&g(f("InvalidArguments"))}function i(a,b){a&&("function"==typeof a?void 0!==a().failure&&a().failure(b):void 0!==a.failure&&a.failure(b))}function j(a,b){a&&("function"==typeof a?a().success(b):a.success(b))}function k(a,b){LoggingService.debug("createErrorObject - (BEGIN)");var c={};return c.message=void 0!==b?b:n(null,null,a)||"",c.errorCode=a||-1,LoggingService.debug("createErrorObject - (END)"),c}function l(a,c){return LoggingService.debug("manageError - (BEGIN)"),LoggingService.debug("manageError - a_ErrorCode ("+a+")"),b(),"6983"===a?d(f("MoveCard")):"6982"===a&&d(f("MoveCard")),LoggingService.debug("manageError - (END)"),k(a,c)}function m(a){J=a;var b={success:function(){j(J,!0)},error:function(a){i(J,l(a,"PCSC error"))}};SConnect.PCSC.Create(b)}function n(a,b,c){LoggingService.debug("checkApduResponse - (BEGIN)"),LoggingService.debug("checkApduResponse - StatusWord ("+a+")"),LoggingService.debug("checkApduResponse - DataOut ("+b+")"),LoggingService.debug("checkApduResponse - ErrorCode ("+c+")");var g,h,i=null;return c?(i=e(c),i||(g=c.toString(16).toUpperCase(),h=P[g]+" (0x"+g+")"||"Unknown PCSC error",LoggingService.error("getErrorPCSC - code ("+g+") - message ("+h+")"),m()===!1&&(h=f("SmartcardServiceNotRunning"),d(h)),i=h)):"9000"===a?null!==b&&void 0!==b&&4===b.length&&(i=e(b)):i=e(a),LoggingService.debug("checkApduResponse - return ("+i+")"),LoggingService.debug("checkApduResponse - (END)"),i}function o(a){J=a;var b={success:function(a){j(J,a.toString(16))},error:function(a){i(J,l(a,"Cannot retrieve the SConnect version. Check your installation"))}};SConnect.GetVersion(b)}function p(a){var b=a.toString(16).toUpperCase(),c=P[b]+" (0x"+b+")"||"Unknown PCSC error";return LoggingService.error("getErrorPCSC - code ("+b+") - message ("+c+")"),k(b,c)}function q(a,c){function k(a,b,c,d){return{success:function(a){var b=a.statusWord,e=a.dataOut,f=b.substr(0,2),g="00",h=b.substr(2,2);d+=e,"61"===f&&"62"===f?(g+="C00000",g+=h,lb.connection.transmit(g,k(b,e,c,d)),LoggingService.debug("getApduResponse - exchangeResponse.statusWord ("+b+")"),LoggingService.debug("getApduResponse - exchangeResponse.dataOut ("+e+")"),LoggingService.debug("getApduResponse - (END)")):c.success(b,d)},error:function(a){void 0!==c.failure?i(c,p(a)):void 0!==c.error&&c.error(a)}}}function m(a){if(LoggingService.debug("beginTransaction - (BEGIN)"),lb&&lb.connection){var b=function(a){return{success:function(b){lb.transactionHandle=b,LoggingService.debug("beginTransaction successful ("+b+")"),LoggingService.debug("beginTransaction - (END)"),j(a)},error:function(b){LoggingService.error("beginTransaction failed"),LoggingService.debug("beginTransaction - (END)"),i(a,p(b))}}};lb.connection.beginTransaction(b(a))}}function o(a){if(LoggingService.debug("endTransaction - (BEGIN)"),lb&&lb.connection)try{var b=function(a){return{success:function(b){lb.transactionHandle=b,LoggingService.debug("endTransaction successful ("+b+")"),LoggingService.debug("endTransaction - (END)"),void 0!==a&&a.success()},error:function(b){LoggingService.error("endTransaction failed ("+b+")"),LoggingService.debug("endTransaction - (END)"),void 0!==a&&a.error(b)}}};lb.connection.endTransaction(b(a))}catch(c){}}function q(a){return{success:function(c,d){LoggingService.debug("apdu_callback_response.success - (BEGIN)"),LoggingService.debug("apdu_callback_response.success - status word ("+c+")"),LoggingService.debug("apdu_callback_response.success - data out ("+d+")"),b();var e,g=c.substr(0,2),h="",j="00",m=c.substr(2,2);try{if("61"===g||"62"===g)return j+="C00000",j+=m,void r(j,k(c,d,q(a),h))}catch(s){o(),i(a,l(-1,s.message||f("PcscError")))}mb=c,nb=d,ob=a,e={success:function(){var a=n(mb,nb,null),b={};a?(LoggingService.error(a),void 0!==ob.failure?ob.failure(l(mb,a)):ob.error(mb,a)):(b.statusWord=mb,b.dataOut=nb,ob.success(b)),LoggingService.debug("apdu_callback_response.success - (END)")},error:function(a){void 0!==ob.failure?ob.failure(p(a)):ob.error(a)}},o(e)},error:function(c){LoggingService.debug("apdu_callback_response.failure - (BEGIN)"),LoggingService.debug("apdu_callback_response.failure - errorCode ("+c+")");var d=n(null,null,c);LoggingService.debug("apdu_callback_response.failure - errorMessage ("+d+")"),b(),o(),LoggingService.debug("apdu_callback_response.failure - (END)"),i(a,p(c))}}}function r(a,c){try{var d=function(b){return{success:function(){LoggingService.debug("apdu_Transmit ("+a+")"),lb.connection.transmit(a,q(b))},failure:function(a){i(b,a)}}};m(d(c))}catch(e){o(),b(),i(c,l(-1,e.message||f("PcscError")))}}function s(a,c,d,e,g){var h,k,n,p=a,q=null,r=null;try{h={success:function(){r?i(p,l(r)):j(p,q)},error:function(){i(p,l(r))}},k={success:function(a){LoggingService.debug("apdu_control - dataOut ("+a+")"),r=null,q=a,lb.connection.endTransaction(h)},error:function(a){LoggingService.error("apdu_control - code ("+a+")"),r=a,lb.connection.endTransaction(h)}},n=function(a,b,c,d){return{success:function(){var e=!0,f=a;void 0!==c&&(e=c),"string"==typeof a&&(f=parseInt(a,16)),LoggingService.debug("apdu_control - controlCode ("+f+")"),LoggingService.debug("apdu_control - template ("+b+")"),LoggingService.debug("apdu_control - raw ("+e+")"),LoggingService.debug("apdu_control - expectedLen ("+d+")"),lb.connection.cardControl(f,b,e,k,d)},failure:function(a){i(p,a)}}},m(n(c,d,e,g))}catch(s){o(),b(),i(a,l(-1,s.message||f("PcscError")))}}function t(a){for(var b=[];a.length>=2;)b.push(parseInt(a.substring(0,2),16)),a=a.substring(2,a.length);return String.fromCharCode.apply(String,b)}function u(a){for(var b=[];a.length>=2;)b.push(parseInt(a.substring(0,2),16)),a=a.substring(2,a.length);return b}function v(a){var b,c="",d=0;for(d=0;d<a.length;d+=1)b=a[d].toString(16),b.length<2&&(c+="0"),c+=b;return c}function w(a){var b=[],c=0;for(c=0;c<a.length/2;c+=1)b[c]=parseInt(a.substring(2*c,2*c+2),16);return b}function x(a,b){b||(b="");var c=v([b.length/2]);return a+c.toUpperCase()+b}function y(a){for(var b,c,d,e,f,g,h,i={},j=function(a){return v(a).toUpperCase()},k=w(a),l=0,m=0;l<k.length;){if(b=[k[l]],31===(31&b[0]))for(l+=1,b[b.length]=k[l];128&b[b.length-1];)l+=1,b[b.length]=k[l];if(l+=1,c=k[l],l+=1,128&c)for(d=127&c,e=k.slice(l,l+d),l+=e.length,c=0,m=0;m<e.length;m+=1)c+=e[m]<<8*(e.length-1-m);f=k.slice(l,l+c),l+=c,g=j(b),h=j(f),i[g]=h}return i}function z(a){for(var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,z,A,B,C,D=y(a).D0,E=[],F=D.substring(0,14);F.length>=2;)E.push(parseInt(F.substring(0,2),16)),F=F.substring(2,F.length);b=parseInt(D.substr(14,2),16),LoggingService.debug("decodePersonalCardReaderInformation - pcr_adb_byte1 ("+b+")"),c=18,F=D.substr(18,D.length-18),128===(128&b)&&(d=4,e=D.substr(c,d),c+=d,LoggingService.debug("decodePersonalCardReaderInformation - lang ("+e+")")),64===(64&b)&&(B=2,C=D.substr(c,B),c+=B,LoggingService.debug("decodePersonalCardReaderInformation - battery ("+C+")")),32===(32&b)&&(f=2,g=D.substr(c,f),c+=f,LoggingService.debug("decodePersonalCardReaderInformation - algo ("+g+")")),16===(16&b)&&(h=4,i=D.substr(c,h),LoggingService.debug("decodePersonalCardReaderInformation - display ("+i+")"),c+=h),8===(8&b)&&(j=2,k=D.substr(c,j),c+=j,LoggingService.debug("decodePersonalCardReaderInformation - characterSets ("+k+")")),4===(4&b)&&(l=4,m=D.substr(c,l),c+=l,LoggingService.debug("decodePersonalCardReaderInformation - keyPad ("+m+")")),2===(2&b)&&(n=88,o=D.substr(c,n),c+=n,LoggingService.debug("decodePersonalCardReaderInformation - versionControl ("+o+")"),p=o.substr(0,2),q=o.substr(2,2),r=o.substr(4,20),s=o.substr(24,30),t=o.substr(54,20),u=o.substr(64,14),LoggingService.debug("decodePersonalCardReaderInformation - PCR_Version_Control ("+p+")"),LoggingService.debug("decodePersonalCardReaderInformation - PCR_Type ("+q+")"),LoggingService.debug("decodePersonalCardReaderInformation - LOC_Identifier ("+r+")"),LoggingService.debug("decodePersonalCardReaderInformation - Manufacturer_Name ("+s+")"),LoggingService.debug("decodePersonalCardReaderInformation - PCR_Software_Version ("+t+")"),LoggingService.debug("decodePersonalCardReaderInformation - Unique_PCR_Identifier ("+u+")")),1===(1&b)&&(v=2,w=D.substr(c,v),c+=v,LoggingService.debug("decodePersonalCardReaderInformation - cardStatusInformation ("+w+")")),x=D.substr(16,2),LoggingService.debug("decodePersonalCardReaderInformation - pcr_adb_byte2 ("+x+")"),"80"===x&&(z=14,A=D.substr(c,z),c+=z,LoggingService.debug("decodePersonalCardReaderInformation - secureChannelStatusInformation ("+A+")")),LoggingService.debug("decodePersonalCardReaderInformation - (END)")}function A(a){LoggingService.debug("getPCRInformation - (BEGIN)");var b="8012000100",c={success:function(b){o();var c=b.statusWord,d=n(c,b.dataOut,null);return d?(LoggingService.error("getPCRInformation - No PersonalCardReaderInformation found"),LoggingService.debug("getPCRInformation - (END)"),void i(a,l(c,d))):(lb.personalCardReaderInformation=b.dataOut,z(lb.personalCardReaderInformation),lb.personalCardReaderInformation?(LoggingService.info("getPCRInformation succeeded"),LoggingService.debug("getPCRInformation - (END)"),void j(a,lb.personalCardReaderInformation)):(LoggingService.error("getPCRInformation - No PersonalCardReaderInformation found"),void i(a,l(c,"No PersonalCardReaderInformation found"))))},failure:function(b){o(),i(a,b)}};try{r(b,c)}catch(d){o(),i(a,l(-1,d.message||f("PcscError")))}LoggingService.debug("getPCRInformation - (END)")}function B(a,b,c,d){if(a.length<=b){for(;a.length<b;)"left"===d?a=c+a:a+=c;return a}return g(f("StringTooLong")),null}function C(a){var b;for(b=0;b<a.length;b+=1)if(a[b]<"0"||a[b]>"9")return!1;return!0}function D(a){var b,c,d;for((a.length<1||a.length>10)&&g(f("IncorrectTDSNumber")),b=0;b<a.length;b+=1)c=a[b],(c.length<1||c.length>10||!C(c))&&g(f("IncorrectTDSFormat"));return d=a.join("F"),d.length%2!==0&&(d+="F"),d}function E(a,b){var c=a[b];return c||g(f("UnknownCurrency")+b),B(c,4,"0","left")}function F(a,b,c,d,e,f){function g(a){return a&&a.length?!0:!1}LoggingService.debug("format_cap_apdu - (BEGIN)");var h,i,j,k,l,m,n,o,p;return h="",g(b)&&(h=x("9F37",B(b,8,"0","left"))),i="",g(c)&&(i=x("9F02",B(c,12,"0","left"))),j="",g(d)&&(C(d)?j=x("5F2A",B(d,4,"0","left")):(k=U.currencies,j=x("5F2A",E(k,d)))),l="",g(f)&&(l=x("C2",D(f))),m="",g(e)&&(e.length<2&&(e="0"+e),m=x("DF71",e)),n=(h.length+i.length+j.length+l.length)/2,o=v([n]),p="8012"+a+"01"+o+h+i+j+l+m,LoggingService.debug("format_cap_apdu - apdu ("+p+")"),LoggingService.debug("format_cap_apdu - (END)"),p}function G(a,b){if(!a||"undefined"==typeof a)return null;var c=a.C1;return b?"F"===c.charAt(c.length-1)?c.slice(0,c.length-1):c:c?parseInt(c,10).toString():c=a.DF70}function I(a){return{success:function(c){o();var d,e,f,g=c.statusWord,h=c.dataOut;LoggingService.debug("innerCallbackCAP.success - (BEGIN)"),LoggingService.debug("innerCallbackCAP.success - StatusWord ("+g+")"),LoggingService.debug("innerCallbackCAP.success - aDataOut ("+h+")"),b(),d=y(h),e=d["9F37"],f=G(d,!1),f?(LoggingService.info("CAP generation succeeded"),LoggingService.debug("innerCallbackCAP.success - (END)"),e?a.success(lb,f,e):a.success(lb,f)):(LoggingService.error("innerCallbackCAP.success - No token found"),LoggingService.debug("innerCallbackCAP.success - (END)"),a.failure(lb,l(g)))},failure:function(c){o(),b(),LoggingService.debug("innerCallbackCAP.failure - (BEGIN)"),LoggingService.debug("innerCallbackCAP.failure - a_ErrorCode ("+c+")"),LoggingService.error("CAP generation failed ("+c+")"),a.failure(lb,c)}}}function J(a,b,c,e,g,i,j){switch(LoggingService.debug("sendCAP - (BEGIN)"),LoggingService.debug("sendCAP - a_iMode ("+b+")"),LoggingService.debug("sendCAP - a_sUnpredictableNumber ("+c+")"),LoggingService.debug("sendCAP - a_sAmount ("+e+")"),LoggingService.debug("sendCAP - a_sCurrency ("+g+")"),LoggingService.debug("sendCAP - a_sPasscode ("+i+")"),LoggingService.debug("sendCAP - a_aTdsData ("+j+")"),h(a),b){case 1:b="02";break;case 2:b=j?"04":"03";break;case 3:b=j?"06":"05";break;default:return}var k=null;try{k=F(b,c,e,g,i,j)}catch(m){return void a.failure(lb,l(-1,m.message))}d(f("ReaderReadInstructions")),r(k,I(a)),LoggingService.debug("sendCAP - (END)")}function K(a,b){return null===a||"undefined"==typeof a?!0:arguments.length>1&&b!==a.length?!0:!1}function L(a,b){var c,d,e;if(K(a))return LoggingService.error("computeStructureVerifyPIN - (END)"),null;if(K(a[enex.FEATURE_PARAMETER_TIMEOUT])&&(a[enex.FEATURE_PARAMETER_TIMEOUT]="00"),K(a[enex.FEATURE_PARAMETER_TIMEOUT2])&&(a[enex.FEATURE_PARAMETER_TIMEOUT2]="00"),K(a[enex.FEATURE_PARAMETER_FORMATSTRING])&&(a[enex.FEATURE_PARAMETER_FORMATSTRING]="00"),K(a[enex.FEATURE_PARAMETER_PINBLOCKSTRING])&&(a[enex.FEATURE_PARAMETER_PINBLOCKSTRING]="00"),K(a[enex.FEATURE_PARAMETER_PINLENGTHFORMAT])&&(a[enex.FEATURE_PARAMETER_PINLENGTHFORMAT]="00"),K(a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT],4)&&(a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT]="0008"),K(a[enex.FEATURE_PARAMETER_ENTRYVALIDATIONCONDITION])&&(a[enex.FEATURE_PARAMETER_ENTRYVALIDATIONCONDITION]="02"),K(a[enex.FEATURE_PARAMETER_NUMBERMESSAGE])&&(a[enex.FEATURE_PARAMETER_NUMBERMESSAGE]="00"),K(a[enex.FEATURE_PARAMETER_LANGID],4)&&(a[enex.FEATURE_PARAMETER_LANGID]="0409"),K(a[enex.FEATURE_PARAMETER_MSGINDEX])&&(a[enex.FEATURE_PARAMETER_MSGINDEX]="00"),K(a[enex.FEATURE_PARAMETER_TEOPROTOCOL],6)&&(a[enex.FEATURE_PARAMETER_TEOPROTOCOL]="000000"),K(a[enex.FEATURE_PARAMETER_DATA]))return null;if(c=a[enex.FEATURE_PARAMETER_TIMEOUT],c+=a[enex.FEATURE_PARAMETER_TIMEOUT2],c+=a[enex.FEATURE_PARAMETER_FORMATSTRING],c+=a[enex.FEATURE_PARAMETER_PINBLOCKSTRING],c+=a[enex.FEATURE_PARAMETER_PINLENGTHFORMAT],c+=a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT].charAt(2),c+=a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT].charAt(3),c+=a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT].charAt(0),c+=a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT].charAt(1),c+=a[enex.FEATURE_PARAMETER_ENTRYVALIDATIONCONDITION],c+=a[enex.FEATURE_PARAMETER_NUMBERMESSAGE],c+=a[enex.FEATURE_PARAMETER_LANGID].charAt(2),c+=a[enex.FEATURE_PARAMETER_LANGID].charAt(3),c+=a[enex.FEATURE_PARAMETER_LANGID].charAt(0),c+=a[enex.FEATURE_PARAMETER_LANGID].charAt(1),c+=a[enex.FEATURE_PARAMETER_MSGINDEX],c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(4),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(5),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(2),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(2),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(0),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(1),d=null,K(a[enex.FEATURE_PARAMETER_DATALENGTH]))d=(a[enex.FEATURE_PARAMETER_DATA].length/2).toString(16).toUpperCase(),d.length<2&&(d="0"+d),c+=d,c+="00",c+="00",c+="00";else{if(8!==a[enex.FEATURE_PARAMETER_DATALENGTH].length)return null;c+=a[enex.FEATURE_PARAMETER_DATALENGTH]}return c=c.concat(a[enex.FEATURE_PARAMETER_DATA]),c.toUpperCase(),d=(c.length/2).toString(16).toUpperCase(),d.length<2&&(d="0"+d),e="",b&&(e=pb,e+=qb,e+=rb,e+=enex.FEATURE_VERIFY_PIN_DIRECT,e+=d),e=e.concat(c),LoggingService.debug("computeStructureVerifyPIN - cmd ("+e+")"),LoggingService.debug("computeStructureVerifyPIN - (END)"),e}function M(a,b){var c,d,e;if(K(a))return LoggingService.error("computeStructureModifyPIN - (END)"),null;if(K(a[enex.FEATURE_PARAMETER_TIMEOUT])&&(a[enex.FEATURE_PARAMETER_TIMEOUT]="00"),K(a[enex.FEATURE_PARAMETER_TIMEOUT2])&&(a[enex.FEATURE_PARAMETER_TIMEOUT2]="00"),K(a[enex.FEATURE_PARAMETER_FORMATSTRING])&&(a[enex.FEATURE_PARAMETER_FORMATSTRING]="00"),K(a[enex.FEATURE_PARAMETER_PINBLOCKSTRING])&&(a[enex.FEATURE_PARAMETER_PINBLOCKSTRING]="00"),K(a[enex.FEATURE_PARAMETER_PINLENGTHFORMAT])&&(a[enex.FEATURE_PARAMETER_PINLENGTHFORMAT]="00"),K(a[enex.FEATURE_PARAMETER_INSERTIONOFFSETOLD])&&(a[enex.FEATURE_PARAMETER_INSERTIONOFFSETOLD]="00"),K(a[enex.FEATURE_PARAMETER_INSERTIONOFFSETNEW])&&(a[enex.FEATURE_PARAMETER_INSERTIONOFFSETNEW]="08"),K(a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT],4)&&(a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT]="0008"),K(a[enex.FEATURE_PARAMETER_CONFIRMPIN])&&(a[enex.FEATURE_PARAMETER_CONFIRMPIN]="03"),K(a[enex.FEATURE_PARAMETER_ENTRYVALIDATIONCONDITION])&&(a[enex.FEATURE_PARAMETER_ENTRYVALIDATIONCONDITION]="02"),K(a[enex.FEATURE_PARAMETER_NUMBERMESSAGE])&&(a[enex.FEATURE_PARAMETER_NUMBERMESSAGE]="00"),K(a[enex.FEATURE_PARAMETER_LANGID],4)&&(a[enex.FEATURE_PARAMETER_LANGID]="0409"),K(a[enex.FEATURE_PARAMETER_MSGINDEX1])&&(a[enex.FEATURE_PARAMETER_MSGINDEX1]="00"),K(a[enex.FEATURE_PARAMETER_MSGINDEX2])&&(a[enex.FEATURE_PARAMETER_MSGINDEX2]="01"),K(a[enex.FEATURE_PARAMETER_MSGINDEX3])&&(a[enex.FEATURE_PARAMETER_MSGINDEX3]="02"),K(a[enex.FEATURE_PARAMETER_TEOPROTOCOL],6)&&(a[enex.FEATURE_PARAMETER_TEOPROTOCOL]="000000"),K(a[enex.FEATURE_PARAMETER_DATA]))return null;if(c=a[enex.FEATURE_PARAMETER_TIMEOUT],c+=a[enex.FEATURE_PARAMETER_TIMEOUT2],c+=a[enex.FEATURE_PARAMETER_FORMATSTRING],c+=a[enex.FEATURE_PARAMETER_PINBLOCKSTRING],c+=a[enex.FEATURE_PARAMETER_PINLENGTHFORMAT],c+=a[enex.FEATURE_PARAMETER_INSERTIONOFFSETOLD],c+=a[enex.FEATURE_PARAMETER_INSERTIONOFFSETNEW],c+=a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT].charAt(2),c+=a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT].charAt(3),c+=a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT].charAt(0),c+=a[enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT].charAt(1),c+=a[enex.FEATURE_PARAMETER_CONFIRMPIN],c+=a[enex.FEATURE_PARAMETER_ENTRYVALIDATIONCONDITION],c+=a[enex.FEATURE_PARAMETER_NUMBERMESSAGE],c+=a[enex.FEATURE_PARAMETER_LANGID].charAt(2),c+=a[enex.FEATURE_PARAMETER_LANGID].charAt(3),c+=a[enex.FEATURE_PARAMETER_LANGID].charAt(0),c+=a[enex.FEATURE_PARAMETER_LANGID].charAt(1),c+=a[enex.FEATURE_PARAMETER_MSGINDEX1],c+=a[enex.FEATURE_PARAMETER_MSGINDEX2],c+=a[enex.FEATURE_PARAMETER_MSGINDEX3],c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(4),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(5),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(2),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(2),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(0),c+=a[enex.FEATURE_PARAMETER_TEOPROTOCOL].charAt(1),d=null,K(a[enex.FEATURE_PARAMETER_DATALENGTH]))d=(a[enex.FEATURE_PARAMETER_DATA].length/2).toString(16).toUpperCase(),d.length<2&&(d="0"+d),c+=d,c+="00",c+="00",c+="00";else{if(8!==a[enex.FEATURE_PARAMETER_DATALENGTH].length)return null;c+=a[enex.FEATURE_PARAMETER_DATALENGTH]}return c=c.concat(a[enex.FEATURE_PARAMETER_DATA]),d=(c.length/2).toString(16).toUpperCase(),d.length<2&&(d="0"+d),e="",b&&(e=pb,e+=qb,e+=rb,e+=enex.FEATURE_MODIFY_PIN_DIRECT,e+=d),c.toUpperCase(),e=e.concat(c),LoggingService.debug("computeStructureModifyPIN - cmd ("+e+")"),LoggingService.debug("computeStructureModifyPIN - (END)"),e}function N(a,b){var c,d;return LoggingService.debug("computeStructureEscapeCommand - (BEGIN)"),K(a)?(LoggingService.error("computeStructureEscapeCommand - Invalid parameter"),LoggingService.debug("computeStructureEscapeCommand - (END)"),null):(c="",b&&(c=pb,c+=qb,c+=rb,c+=enex.FEATURE_CCID_ESC_COMMAND,d=(a.length/2).toString(16).toUpperCase(),d.length<2&&(d="0"+d),c+=d),a.toUpperCase(),c=c.concat(a),LoggingService.debug("computeStructureEscapeCommand - cmd ("+c+")"),LoggingService.debug("computeStructureEscapeCommand - (END)"),c)}function O(a){LoggingService.info("readerGetFeatures - (BEGIN)"),lb.featuresPCSC=[];var b=3400,c="",d=!1,e=114,f={success:function(b){o();var c,d,e,f,g,h=n(b,null,null);if(h)return LoggingService.error("=============== found error "+h),void a.failure(h);for(c=b.length,d=0;c>d;d+=12)e=b.substr(d,2),f=b.substr(d+2,2),g=b.substr(d+4,8),LoggingService.info("readerGetFeatures - tag ("+e+") - len ("+f+") - val ("+g+")"),lb.featuresPCSC[e]=g;LoggingService.info("readerGetFeatures - response ("+b+")"),a.success()},failure:function(b){LoggingService.error("readerGetFeatures - errorCode ("+b+")"),a.failure(b)}};try{s(f,b,c,d,e)}catch(g){return void LoggingService.error("readerGetFeatures - e ("+g+")")}LoggingService.info("readerGetFeatures - (END)")}function P(a,b,c){var d,e=1;return a&&(e+=128),b&&(e+=64),c&&(e+=32),d=15>=e?"0":"",d+=e.toString(16),d.toUpperCase(),d}function Q(a,b,c,d,e,h){LoggingService.debug("secureChannelComputeAPDU - (BEGIN)"),(null===a||"undefined"==typeof a)&&g(f("InvalidSecureChannelOperationParameter"));var i,j,k,l=cb;return null!==c&&"undefined"!=typeof c&&(l=c?cb:bb),i=l,i+=db,i+=a,j=P(d,e,h),i+=j,b&&b.length>1&&(k=b.length/2,k=(15>=k?"0":"")+k,i+=k.toString(16).toUpperCase(),i+=b),LoggingService.debug("secureChannelComputeAPDU - APDU ("+i+")"),LoggingService.debug("secureChannelComputeAPDU - (END)"),i}function R(a,b){var c,d,e=[];for(c=0;c<a.length;c+=1)e.push(a.charCodeAt(c));if(d=v(e),b)for(;d.length<2*b;)d="30"+d;return d}function S(a,b){var c,d,e;return"DID"===a.type&&(b.length<3&&g(f("InvalidDecimalValue")),d=b.charAt(b.length-3),"."!==d&&","!==d&&g(f("InvalidDecimalValue")),b=b.substring(0,b.length-3)+b.substring(b.length-2,b.length),C(b)||g(f("InvalidDecimalValue"))),(b.length<a.min_length||b.length>a.max_length)&&g(f("InvalidDataLength")),C(b)||g(f("InputMustBeDigitsOnly")),c=a.bcd?b.length%2!==0?"0"+b:b:"NID"===a.type||"DID"===a.type?R(b,12):R(b),e=v([c.length/2]),a.tag+e.toUpperCase()+c}function V(a,b){var c=a.allowed_values[b];return c||g(f("UnknownValue")),a.bcd?x(a.tag,E(U.configuration.currencies,b)):x(a.tag,R(c))}function W(a,b,c){var d,e,f,h,i=!1;if(c)for(e=0;e<c.length;e+=1)if(f=c[e][0],h=c[e][1],b.length<=h){for(d="",e=0;e<b.length;e+=1)d+=B(b[e],f," ");for(e=b.length;h>e;e+=1)d+=B("",f," ");i=!0;break}return i||g("Too many lines in free text data."),x(a.tag,R(d))}function Y(a,b,c){var d,e,h,i,j=!1,k="";for(b[b.length-1]||b.pop(),d=0;d<b.length;d+=1)e=b[d][0],h=b[d][1],i=a[e],i||g(f("UnknownSWYSPrimitive")+e),"INPUT_CURRENCY"===e?j=!0:"INPUT_AMOUNT_WITH_CURRENCY"===e&&j?j=!1:"INPUT_AMOUNT_WITH_CURRENCY"===e&&g(f("InvalidINPUT_AMOUNT_WITH_CURRENCYParameter")),"ID"===i.type||"IDG"===i.type||"NID"===i.type||"DID"===i.type?k+=S(i,h):"SD"===i.type?k+=V(i,h):"MD"===i.type?k+=x(i.tag):"E0"===i.type?k+=W(i,h,c):"E1"===i.type?k+=x(i.tag,h):g(f("InvalidPrimitiveType"));return j&&g(f("InvalidCurrencyWithoutAmountParameter")),k.length>2*sb&&g(f("MaximumSignBufferSizeExceeded")),k}var Z="9F37",$=8,_="DF72",ab="E7",bb="80",cb="84",db="12",eb="10",fb="11",gb=!1,hb=null,ib=null,jb=null,kb=null,lb=this,mb=null,nb=null,ob=null,pb="FF",qb="C2",rb="01",sb=255;this.readerName=a,this.atr=c,this.personalCardReaderInformation=null,this.pan=null,this.psn=null,this.expirationDate=null,this.transactionHandle=0,this.connection=null,this.create=function(a){kb=a;var b={success:function(){j(kb,T),X&&X(T)},error:function(a){lb.connection.dispose(),lb.connection=null,i(kb,p(a))}},c={success:function(a){lb.connection=a,lb.connection.connect(lb.readerName,b)},error:function(a){i(kb,p(a))}};SConnect.PCSC.Create(c)},this.sendAPDUAsynchronous=function(a,b){r(a,b)},H.sendAPDUAsynchronous=this.sendAPDUAsynchronous,this._get_device_info=function(a){LoggingService.debug("_get_device_info - (BEGIN)");var b="D039000000",c={success:function(b){o();var c,d,e,f,g,h,k,m,p=b.statusWord,q=b.dataOut,r=y(q),s=null;return r.A1&&(s=y(r.A1)),c=n(p,q),c||!s?(LoggingService.error("_get_device_info - No device info found"),LoggingService.debug("_get_device_info - (END)"),void i(a,l(c))):(d={},e=s.C1,e&&(d.C1=t(e)),f=s.C2,f&&(d.C2=parseInt(f,16)),g=s.C3,g&&(d.C3=parseInt(g,16)),h=s.C4,h&&(d.C4=u(h,16)),k=s.C5,k&&(d.C5=t(k)),m=s.C6,m&&(d.C6=t(m)),LoggingService.debug("_get_device_info - C1 ("+d.C1+")"),LoggingService.debug("_get_device_info - C2 ("+d.C2+")"),LoggingService.debug("_get_device_info - C3 ("+d.C3+")"),LoggingService.debug("_get_device_info - C4 ("+d.C4+")"),LoggingService.debug("_get_device_info - C5 ("+d.C5+")"),LoggingService.debug("_get_device_info - C6 ("+d.C6+")"),LoggingService.info("_get_device_info succeeded"),void j(a,q))},failure:function(b){o(),i(a,b)}};try{r(b,c)}catch(d){o(),i(a,l(-1,d.message||f("PcscError")))}LoggingService.debug("_get_device_info - (END)")},this.getPersonalCardReaderInformation=function(a){LoggingService.debug("getPersonalCardReaderInformation - (BEGIN)"),h(a),A(a),LoggingService.debug("getPersonalCardReaderInformation - (END)")},H.getPersonalCardReaderInformation=this.getPersonalCardReaderInformation,this.getSecureChannelState=function(a){LoggingService.debug("getSecureChannelState - (BEGIN)"),h(a);var b=!0,c={success:function(){j(a,!1)},failure:function(b){return"6710"===b.errorCode?void j(a,!0):void j(a,!1)}};A(c,b),LoggingService.debug("getSecureChannelState - (END)")},H.getSecureChannelState=this.getSecureChannelState,this.dispose=function(){LoggingService.debug("dispose - (BEGIN)"),o(),this.readerName=null,this.atr=null,this.pan=null,this.psn=null,this.personalCardReaderInformation=null,this.connection&&this.connection.dispose(),LoggingService.debug("dispose - (END)")},this.cap_mode1=function(a,b,c,d,e){LoggingService.debug("CAPMode1 - (BEGIN)"),LoggingService.debug("CAPMode1 - a_sUnpredictableNumber ("+b+")"),LoggingService.debug("CAPMode1 - a_sAmount ("+c+")"),LoggingService.debug("CAPMode1 - a_sCurrency ("+d+")"),LoggingService.debug("CAPMode1 - a_sPasscode ("+e+")"),J(a,1,b,c,d,e,null),LoggingService.debug("CAPMode1 - (END)")},this.cap_mode2=function(a,b,c){LoggingService.debug("CAPMode2 - (BEGIN)"),LoggingService.debug("CAPMode2 - a_aTdsData ("+b+")"),LoggingService.debug("CAPMode2 - a_sPasscode ("+c+")"),J(a,2,null,null,null,c,b),LoggingService.debug("CAPMode2 - (END)")},this.cap_mode3=function(a,b,c,d){LoggingService.debug("CAPMode3 - (BEGIN)"),LoggingService.debug("CAPMode3 - a_sUnpredictableNumber ("+b+")"),LoggingService.debug("CAPMode3 - a_aTdsData ("+c+")"),LoggingService.debug("CAPMode3 - a_sPasscode ("+d+")"),J(a,3,b,null,null,d,c),LoggingService.debug("CAPMode3 - (END)")},this.get_pan_psn=function(a){function c(a){return{success:function(c){o(),b();var d,e,f,g=c.statusWord,h=c.dataOut;if(LoggingService.debug("getPrimaryAccountNumber.success - StatusWord ("+g+")"),LoggingService.debug("getPrimaryAccountNumber.success - DataOut ("+h+")"),"9000"!==g)return void a.failure(lb,l(g));if(d=y(h),d&&(e=y(d.A2))){for(lb.pan=e["5A"],f=lb.pan.length-1;0!==f&&"F"===lb.pan[f];f-=1);return lb.pan=lb.pan.substring(0,f+1),lb.psn=e["5F34"],lb.expirationDate=e["5F24"],LoggingService.info("getPrimaryAccountNumber succeeded"),LoggingService.debug("getPrimaryAccountNumber - (END)"),void a.success(lb,lb.pan,lb.psn,lb.expirationDate)}LoggingService.error("getPrimaryAccountNumber - No PAN found"),LoggingService.debug("getPrimaryAccountNumber - (END)"),a.failure&&a.failure(lb,l(g,"No PAN found"))},failure:function(c){o(),b(),LoggingService.error("getPrimaryAccountNumber failed"),LoggingService.debug("getPrimaryAccountNumber.failure",c),LoggingService.debug("getPrimaryAccountNumber - (END)"),a.failure&&a.failure(lb,c)}}}if(LoggingService.debug("getPrimaryAccountNumber - (BEGIN)"),h(a),this.pan)return LoggingService.info("getPrimaryAccountNumber succeeded"),LoggingService.debug("getPrimaryAccountNumber - PAN already available ("+this.pan+")"),LoggingService.debug("getPrimaryAccountNumber - (END)"),void a.success(this,this.pan,this.psn,this.expirationDate);d(f("ConfirmPAN"));var e="D038000000";r(e,c(a)),LoggingService.debug("getPrimaryAccountNumber - (END)")},this.sendPPDU=function(a,c,e,g){function k(a){return{success:function(c){o(),b();var d,e=c.statusWord,f=c.dataOut;LoggingService.debug("sendPPDU.success - StatusWord ("+e+")"),LoggingService.debug("sendPPDU.success - DataOut ("+f+")"),"9000"!==e?(LoggingService.error("sendPPDU.success - dataOut present to report an error ("+f+")"),LoggingService.error("sendPPDU.success - one of the incoming feature structure parameters is wrong"),d=n(e,f),i(a,l(e,d))):(LoggingService.info("sendPPDU succeeded"),j(a,f)),LoggingService.debug("sendPPDU - (END)")},failure:function(c){o(),b(),LoggingService.debug("sendPPDU.failure"),i(a,c),LoggingService.debug("sendPPDU - (END)")}}}LoggingService.debug("sendPPDU - (BEGIN)"),LoggingService.debug("sendPPDU - a_iFeature ("+c+")"),LoggingService.debug("sendPPDU - a_oFeatureParameters ("+e+")"),LoggingService.debug("sendPPDU - a_bNoGUI ("+g+")"),h(a);var m=null;switch(c){case enex.FEATURE_VERIFY_PIN_DIRECT:m=L(e,!0);
break;case enex.FEATURE_MODIFY_PIN_DIRECT:m=M(e,!0);break;case enex.FEATURE_CCID_ESC_COMMAND:m=N(e,!0);break;default:i(a,l(-1,f("FeatureNotSupported")))}m||i(a,l(-1,f("InvalidArguments"))),g||d(f("ReaderReadInstructions")),r(m,k(a)),LoggingService.debug("sendPPDU - (END)")},this.setPersonalCardReaderLanguage=function(a,b,c,d){b&&4===b.length||i(a,l(-1,f("InvalidArguments"))),c!==!0&&c!==!1&&(c=!0),d!==!0&&d!==!1&&(d=!0);var e="6D";e+=!0===c?d?"02":"04":d?"01":"03",e+=b,this.sendPPDU(a,enex.FEATURE_CCID_ESC_COMMAND,e,!0)},this.getPersonalCardReaderLanguage=function(a){var b="6D";this.sendPPDU(a,enex.FEATURE_CCID_ESC_COMMAND,b,!0)},this.featuresPCSC=[],this.sendSPE=function(a,c,g){LoggingService.debug("sendSPE - (BEGIN)"),LoggingService.debug("sendSPE - a_iFeature ("+c+")"),LoggingService.debug("sendSPE - a_oFeatureParameters ("+g+")"),h(a);var k=function(a){return{success:function(){function h(a){return{success:function(c){o(),b(),LoggingService.debug("sendSPE.success - DataOut ("+c+")");var d=e(c);return d?void i(a,l(c,d)):(LoggingService.info("sendSPE succeeded"),LoggingService.debug("sendSPE - (END)"),void j(a,c))},failure:function(c){b(),LoggingService.error("sendSPE failed ("+c+")"),i(a,c),LoggingService.debug("sendSPE - (END)")}}}var k=lb.featuresPCSC[c],m=null;if(!k)return void i(a,l(-1,f("FeatureNotSupported")));switch(c){case enex.FEATURE_VERIFY_PIN_DIRECT:m=L(g);break;case enex.FEATURE_MODIFY_PIN_DIRECT:m=M(g);break;case enex.FEATURE_CCID_ESC_COMMAND:m=N(g);break;default:i(a,l(-1,f("FeatureNotSupported")))}return m?(d(f("ReaderReadInstructions")),void s(h(a),k,m)):void i(a,l(-1,f("InvalidArguments")))},failure:function(b){LoggingService.error("sendSPE failed ("+b+")"),i(a,b),LoggingService.debug("sendSPE - (END)")}}};O(k(a)),LoggingService.debug("sendSPE - (END)")},this.secureChannelEstablishment=function(a,c,e,g,k,m,n,p){function q(a){return{success:function(c){o(),b();var d=c.statusWord,e=c.dataOut;return LoggingService.debug("innerCallbackSecureChannelEstablishment.success - (BEGIN)"),LoggingService.debug("innerCallbackSecureChannelEstablishment.success - StatusWord ("+d+")"),LoggingService.debug("innerCallbackSecureChannelEstablishment.success - aDataOut ("+e+")"),LoggingService.debug("innerCallbackSecureChannelEstablishment.success - (END)"),"9000"!==d?void i(a,l(d)):(gb=!0,void j(a,e))},failure:function(c){o(),gb=!1,hb=null,ib=null,jb=null,LoggingService.debug("innerCallbackSecureChannelEstablishment.failure - (BEGIN)"),LoggingService.debug("innerCallbackSecureChannelEstablishment.failure - errorCode ("+c.errorCode+")"),LoggingService.debug("innerCallbackSecureChannelEstablishment.failure - message ("+c.message+")"),b(),i(a,c),LoggingService.debug("innerCallbackSecureChannelEstablishment.failure - (END)")}}}LoggingService.debug("SecureChannelEstablishment - (BEGIN)"),LoggingService.debug("SecureChannelEstablishment - a_sUnpredictableNumber ("+c+")"),LoggingService.debug("SecureChannelEstablishment - a_sSecureChannelConfiguration ("+e+")"),LoggingService.debug("SecureChannelEstablishment - a_sPasscodeConfiguration ("+g+")"),LoggingService.debug("SecureChannelEstablishment - a_sApplicationSelectionList ("+k+")"),LoggingService.debug("SecureChannelEstablishment - a_EncryptionIndicator ("+m+")"),LoggingService.debug("SecureChannelEstablishment - a_TerminateSecureChannelIndicator ("+n+")"),LoggingService.debug("SecureChannelEstablishment - a_WaitCardIndicator ("+p+")"),h(a);var s,t,u,v,w,y="",z="",A="",C="",D="9F06",E="",F="DF71";if(c&&(y=x(Z,B(c,$,"0","left"))),e&&(z=x(_,e)),k){for(t=0;t<k.length;t+=1)C+=x(D,k[t]);A=x(ab,C)}g&&(E=x(F,g)),s=y+z+A+E,hb=m,ib=n,jb=p,u=P(hb,ib,jb),v=bb+db+eb+u,w=(s.length/2).toString(16).toUpperCase(),w.length<2&&(w="0"+w),v+=w,v+=s,LoggingService.debug("SecureChannelEstablishment - apdu ("+v+")"),d(f("ReaderReadInstructions")),r(v,q(a))},this.secureChannelTermination=function(a,c){function d(a){return{success:function(c){o();var d=c.statusWord,e=c.dataOut;return LoggingService.debug("SecureChannelTermination.success - (BEGIN)"),LoggingService.debug("SecureChannelTermination.success - StatusWord ("+d+")"),LoggingService.info("SecureChannelTermination - Successfully terminated. PCR returned ("+e+")"),b(),"9000"!==d?void i(a,l(d)):(LoggingService.debug("SecureChannelTermination.success - (END)"),void j(a,e))},failure:function(c){o(),LoggingService.debug("SecureChannelTermination.failure - (BEGIN)"),LoggingService.debug("SecureChannelTermination.failure - errorCode ("+c.errorCode+")"),LoggingService.debug("SecureChannelTermination.failure - message ("+c.message+")"),b(),LoggingService.debug("SecureChannelTermination.failure - (END)"),i(a,c)}}}if(LoggingService.debug("SecureChannelTermination - (BEGIN)"),h(a),!c||"undefined"==typeof c||c.length<1)return LoggingService.error("SecureChannelTermination - Invalid parameter MAC"),void i(a,l(-1,f("InvalidArguments")));var e=Q(fb,c,1,hb);LoggingService.debug("SecureChannelTermination - APDU ("+e+")"),r(e,d(a))},this.swys=function(a,c,e,g,i){function j(a){return{success:function(c){o();var d,e,f=c.statusWord,g=c.dataOut;return LoggingService.debug("SignWhatYouSee.success - (BEGIN)"),LoggingService.debug("SignWhatYouSee.success - StatusWord ("+f+")"),LoggingService.debug("SignWhatYouSee.success - DataOut ("+g+")"),b(),"9000"!==f?void a.failure(lb,l(f)):(d=y(g),e=G(d,!0),e?(LoggingService.info("SignWhatYouSee - Successfully generated token ("+e+")"),LoggingService.debug("SignWhatYouSee.success - (END)"),a.success(lb,e)):(LoggingService.error("SignWhatYouSee.success - No token found"),LoggingService.debug("SignWhatYouSee.success - (END)"),a.failure(lb,l(-1,"No token found in the response"))),void LoggingService.debug("SignWhatYouSee.success - (END)"))},failure:function(c){o(),LoggingService.debug("SignWhatYouSee.failure - (BEGIN)"),LoggingService.debug("SignWhatYouSee.failure - code ("+c.errorCode+")"),LoggingService.debug("SignWhatYouSee.failure - message ("+c.message+")"),b(),a.failure(lb,c),LoggingService.debug("SignWhatYouSee.failure - (END)")}}}LoggingService.debug("SignWhatYouSee - (BEGIN)"),h(a);var k,m,n=[[17,4],[17,3]],p={BANK:"01",SHOP:"02"}[c],q={gemalto:"00",mode2tds:"01",mode3tds:"02"}[g],s=null;if(!p)return LoggingService.error("SignWhatYouSee - Invalid parameter 'application'"),void a.failure(lb,f("InvalidArguments"));if(!q)return LoggingService.error("SignWhatYouSee - Invalid parameter 'algorithm'"),void a.failure(lb,l(-1,f("InvalidArguments")));if(void 0!==i&&(n=i),!e||"undefined"==typeof e||e.length<1)return LoggingService.error("SignWhatYouSee - Invalid parameter 'data'"),void a.failure(lb,l(-1,f("InvalidArguments")));s=null;try{s=Y(U.primitives,e,n)}catch(t){return void a.failure(lb,l(-1,t.message))}k=v([s.length/2]),m="D034"+p+q+k+s,LoggingService.debug("SignWhatYouSee - APDU ("+m+")"),d(f("ReaderReadInstructions")),r(m,j(a))},this.is_gemalto_driver_installed=function(a){function b(a){return{success:function(b){o();for(var c,d=[];b.length>=2;)d.push(parseInt(b.substring(0,2),16)),b=b.substring(2,b.length);c=String.fromCharCode.apply(String,d),j(a,0===c.search("Gemalto"))},failure:function(){j(a,!1)}}}LoggingService.debug("is_gemalto_driver_installed - (BEGIN)"),h(a);try{var c=2049,d="90010700",e=!1;s(b(a),c,d,e)}catch(f){j(a,!1)}LoggingService.debug("is_gemalto_driver_installed - (END)")}}function r(a,b,c){LoggingService.debug("connectionCreate - (BEGIN)"),LoggingService.debug("connectionCreate - Reader name ("+a+")"),LoggingService.debug("connectionCreate - Smart card ATR ("+b+")"),T&&null!==T.connection&&T.connection.dispose(),T=new q(a,b),J=c;var d=function(a){return{success:function(b){T=b,j(a,T)},failure:function(a){i(J,a)}}};T.create(d(c)),LoggingService.debug("connectionCreate - (END)")}function s(a){LoggingService.debug("connectionDelete - (BEGIN)"),T&&(void 0===a||a===T.readerName)&&(T.dispose(),T=null),LoggingService.debug("connectionDelete - (END)")}function t(){LoggingService.debug("dispose - (BEGIN)"),b(),s(),Y=null,Z=null,SConnect.PCSC.UnregisterCardIRHandler(),LoggingService.debug("dispose - (END)")}function u(a,b,c,d,e,g,h,j,k,m){LoggingService.debug("initialize - (BEGIN)"),Y=null,Z=null,N=!0,null!==j&&"boolean"==typeof j&&(N=j),_=null,m&&"undefined"!=typeof m&&(_=m),K=null,k&&"undefined"!=typeof k&&(K=k),b&&"function"==typeof b&&(Q=b),c&&"function"==typeof c&&(X=c),e&&"function"==typeof e&&(W=e),d&&"function"==typeof d&&(V=d),U=S,a&&"undefined"!=typeof a&&(U=a),U.primitives.INPUT_CURRENCY.allowed_values=U.currencies,null!==g&&"undefined"!=typeof g&&(ab=g,SConnect.ConfigResources(g)),(null===h||"undefined"==typeof h)&&(h=!1),$=!1,h===!0&&($=!0);var n={success:function(){null!==ab&&"undefined"!==ab&&"undefined"!==ab.licensePath?SConnect.ValidateServer(G,!$,ab.licensePath):SConnect.ValidateServer(G,!$)},error:function(){LoggingService.debug("installCallback.error"),i(_,l(-1,f("SConnectNotInstalled")))}};SConnect.Install(n,$),LoggingService.debug("initialize - (END)")}function v(){return T&&T.connection?T:null}function w(a){r(Y,Z,a)}function x(a,b){h(b);var c=null,d={success:function(a){var d;for(d=0;d<a.length;d+=1)LoggingService.info("list_readers - ("+a[d]+")");c&&c.dispose(),j(b,a)},error:function(a){c&&c.dispose(),i(b,p(a))}},e={success:function(b){b.listReaders(a,d)},error:function(){i(b,l(-1,f("PcscError")))}};try{SConnect.PCSC.Create(e)}catch(g){b.success([])}}function y(){return LoggingService.getRecords()}function z(a,b){if(!XMLHttpRequest)return null;var c=new XMLHttpRequest;return b?(c.open("GET",a,!0),c.onreadystatechange=function(){4===c.readyState&&b(c.status,c.responseText)},c.send(),null):(c.open("GET",a,!1),c.send(),[c.status,c.responseText])}function A(a){LoggingService.debug("is_installed - (BEGIN)");var b={success:function(b){b?i(a,l(-1,"update required")):j(a)},error:function(b){i(a,l(b))}};SConnect._isInstalled(b),LoggingService.debug("is_installed - (END)")}function B(a,b,c){var d={success:function(){null!==b&&"undefined"!==b&&"undefined"!==b.licensePath?SConnect.ValidateServer(G,c,b.licensePath):SConnect.ValidateServer(G,c)},error:function(){LoggingService.debug("installCallback.error"),i(a,l(-1,f("SConnectNotInstalled")))}};SConnect.Install(d,!c)}function C(){LoggingService.debug("getPlatformInformation - (BEGIN)");var a={BrowserName:SConnectBrowserDetect.browser,BrowserVersion:SConnectBrowserDetect.version,OS:SConnectBrowserDetect.OS};return LoggingService.info("getPlatformInformation - BrowserName ("+SConnectBrowserDetect.browser+")"),LoggingService.info("getPlatformInformation - BrowserVersion ("+SConnectBrowserDetect.version+")"),LoggingService.info("getPlatformInformation - OS ("+SConnectBrowserDetect.OS+")"),LoggingService.debug("getPlatformInformation - (END)"),a}function D(){var a=SConnect._isSupported();return!1===a&&d(f("BrowserNotSupported")),LoggingService.info("isBrowserSupported - ("+a+")"),a}window.LoggingService||(window.LoggingService={debug:function(){},info:function(){},warning:function(){},error:function(){}},window.console&&window.console.warn&&window.console.warn("======== EWC ======== LoggingService JavaScript not included in your page")),window.SConnect||window.console&&window.console.error&&window.console.error("======== EWC ======== SConnect JavaScript not included in your page");var E,F,G,H={},I="enexModalBox",J=null,K=null,L="en",M=["fr","en"],N=!0,O=[],P=[],Q=null,R={AddonsInstallationFailed:["L'installation des add-ons SConnect a \xe9chou\xe9","SConnect add-ons installation failed"],ValidationLicenseFailed:["La license SConnect n'est pas valide","The SConnect license is not valid"],SmartcardServiceNotRunning:["Le service carte \xe0 puce ne fonctionne pas. Merci de le lancer.","Smart card service in your computer is stopped,<br> please activate the smart card service in your control panel"],UnknownError:["Erreur inconnue","Unknown error"],AbortedByUser:["Operation abandonn\xe9e par l'utilisateur","Operation aborted by user"],ReaderRemoved:["Lecteur retir\xe9","Reader removed"],CardRemoved:["Carte retir\xe9e","Card removed"],CardBlocked:["Carte bloqu\xe9e","Smart card is blocked"],CardMute:["Carte muette. Retirer et r\xe9-ins\xe9rer la carte dans le lecteur","Card mute. Remove and then re-insert the smart card into the reader"],MoveCard:["Retirer et r\xe9-ins\xe9rer la carte dans le lecteur","Remove and then re-insert the smart card into the reader"],FunctionNotSupported:["Fonction non support\xe9e par le lecteur","Function not supported by the reader"],InvalidArguments:["Param\xe8tre invalide","Invalid Parameter"],HardwareRequired:["Veuillez connecter un lecteur et ins\xe9rer une carte \xe0 puce","Please connect a reader and insert a smart card"],ReaderNotCAP:["Votre lecteur n'est pas compatible","Your reader is not compatible"],SeamInstall:["Un composant doit \xeatre install\xe9 dans votre navigateur.<br>Merci de suivre la proc\xe9dure ","A component need to be installed in your browser.<br>Please follow the procedure "],BrowserNotSupported:["Votre navigateur n'est pas support\xe9.","Your browser is not supported."],ReaderReadInstructions:["Veuillez suivre les instructions indiqu\xe9es sur votre lecteur","Please follow the instructions displayed on your reader."],OperationSucceeded:["Op\xe9ration r\xe9ussie. Votre OTP est ","Operation succeeded. Your OTP is "],ConfirmPAN:["Veuillez confirmer la lecture du PAN sur votre lecteur ","Please confirm the PAN query on your reader screen "],PcscError:["Une erreur de communication avec le lecteur s'est produite ","A communication error with the PCR occurred "],SConnectNotInstalled:["SConnect non install\xe9 ","SConnect not installed "],PCRInformationFailed:["Impossible de lire les informations du PCR ","Not able to read PCR information "],StringTooLong:["Cha\xeene trop longue ","String too long "],IncorrectTDSNumber:["Nombre de champs TDS incorrect ","Incorrect number of TDS data fields "],IncorrectTDSFormat:["Format de champs TDS incorrect ","Incorrect formatted TDS data input "],UnknownCurrency:["Monnaie inconnue: ","Unknown currency: "],UnknownSWYSPrimitive:["Primitive SWYS inconnue: ","Unknown SWYS primitive: "],FeatureNotSupported:["Commande non support\xe9e ","Feature not supported "],InvalidSecureChannelOperationParameter:["SecureChannel operation invalide ","Invalid Secure Channel operation parameter "],InvalidINPUT_AMOUNT_WITH_CURRENCYParameter:["Primitive INPUT_AMOUNT_WITH_CURRENCY utilis\xe9e sans INPUT_CURRENCY ","INPUT_AMOUNT_WITH_CURRENCY primitive used without INPUT_CURRENCY "],InvalidPrimitiveType:["Type de primitive inconnu ","Unknown SWYS primitive type "],InvalidCurrencyWithoutAmountParameter:["Primitive Monnaie d\xe9finie sans param\xe8tre montant","INPUT_CURRENCY primitive used without INPUT_AMOUNT_WITH_CURRENCY "],MaximumSignBufferSizeExceeded:["Taille de signature incorrect","Maximum sign buffer size exceeded "],InvalidDecimalValue:["La valeur decimale (DID) doit avoir un . ou un , comme s\xe9parateur d\xe9cimal et deux chiffres apr\xe9s la virgule","Decimal values (DID) must have a . or , as decimal separator followed by two decimal digits "],InvalidDataLength:["Taille de donn\xe9e incorrecte","Incorrect data length "],InputMustBeDigitsOnly:["Les donn\xe9es doivent \xeatre compos\xe9es seulement de digits","Input must be digits only "],UnknownValue:["Valeur inconnue","Unknown value "]},S={currencies:{EUR:"978",USD:"840",GBP:"826",BRL:"986",ARS:"032",SEK:"752",Other:"999"},primitives:{INPUT_FURTHER_INPUTS:{type:"ID",tag:"DF43",min_length:3,max_length:11},INPUT_CHALLENGE:{type:"IDG",tag:"9F37",min_length:0,max_length:8},INPUT_AMOUNT:{type:"DID",tag:"9F03",min_length:1,max_length:12},INPUT_ACCOUNT_NUMBER:{type:"ID",tag:"DF03",min_length:1,max_length:17},INPUT_TO_ACCOUNT:{type:"ID",tag:"DF04",min_length:1,max_length:17},INPUT_FROM_ACCOUNT:{type:"ID",tag:"5A",min_length:1,max_length:17},INPUT_PG_BG:{type:"SD",tag:"DF06",allowed_values:{PG:"1",BG:"2"}},INPUT_REF_ORDER_NUMBER:{type:"ID",tag:"DF07",min_length:1,max_length:28},INPUT_REFERENCE_NUMBER:{type:"ID",tag:"DF08",min_length:0,max_length:28},INPUT_NUMBER_OF_PAYMENTS:{type:"NID",tag:"C3",min_length:0,max_length:12},INPUT_DATE:{type:"ID",tag:"9A",min_length:6,max_length:8},INPUT_CHECKSUM:{type:"ID",tag:"DF64",min_length:0,max_length:17},INPUT_TIME:{type:"ID",tag:"DF14",min_length:4,max_length:4},INPUT_NOT_BEFORE:{type:"ID",tag:"DF15",min_length:6,max_length:8},INPUT_CURRENCY:{type:"SD",tag:"5F2A",allowed_values:"currencies"},INPUT_AMOUNT_WITH_CURRENCY:{type:"DID",tag:"9F02",min_length:1,max_length:12},INPUT_BUY_SELL:{type:"SD",tag:"DF17",allowed_values:{BUY:"1",SELL:"2"}},INPUT_IBAN:{type:"ID",tag:"DF18",min_length:6,max_length:28},INPUT_LIMIT:{type:"DID",tag:"DF19",min_length:1,max_length:12},INPUT_USER_ID:{type:"ID",tag:"DF20",min_length:0,max_length:17},INPUT_UNITS:{type:"DID",tag:"DF21",min_length:1,max_length:12},INPUT_IDENTITY_NUMBER:{type:"ID",tag:"DF23",min_length:6,max_length:17},INPUT_EXTRA_CODE:{type:"IDG",tag:"DF24",min_length:2,max_length:12},INPUT_QUANTITY:{type:"NID",tag:"DF25",min_length:1,max_length:11},INPUT_PHONE_NUMBER:{type:"ID",tag:"DF26",min_length:5,max_length:17},INPUT_DATA:{type:"ID",tag:"DF71",min_length:1,max_length:17},INPUT_DATA_2:{type:"ID",tag:"DF72",min_length:1,max_length:17},INPUT_DATA_3:{type:"ID",tag:"DF73",min_length:1,max_length:17},INPUT_DATA_4:{type:"ID",tag:"DF74",min_length:1,max_length:17},INPUT_DATA_5:{type:"ID",tag:"DF75",min_length:1,max_length:17},INPUT_DATA_6:{type:"ID",tag:"DF76",min_length:1,max_length:17},INPUT_DATA_7:{type:"ID",tag:"DF77",min_length:1,max_length:17},INPUT_DATA_8:{type:"ID",tag:"DF78",min_length:1,max_length:17},INPUT_DATA_9:{type:"ID",tag:"DF79",min_length:1,max_length:17},INPUT_DATA_10:{type:"ID",tag:"DF7A",min_length:1,max_length:17},INPUT_PASSCODE:{type:"ID",tag:"DF1C",min_length:0,max_length:17},INPUT_DUE_DATE:{type:"ID",tag:"DF37",min_length:6,max_length:8},INPUT_LOGIN_CODE:{type:"ID",tag:"DF38",min_length:0,max_length:17},INPUT_TOTAL_AMOUNT:{type:"DID",tag:"DF39",min_length:1,max_length:12},INPUT_VALID_UNTIL:{type:"ID",tag:"DF40",min_length:6,max_length:8},INPUT_TO_DATE:{type:"ID",tag:"DF41",min_length:6,max_length:8},INPUT_FROM_DATE:{type:"ID",tag:"DF42",min_length:6,max_length:8},MESSAGE_INTERNATIONAL_PAYMENT:{type:"MD",tag:"BF11"},MESSAGE_BUY_SELL_SHARES:{type:"MD",tag:"BF12"},MESSAGE_NEW_PHONE_NUMBER:{type:"MD",tag:"BF13"},MESSAGE_NEW_PG_BG:{type:"MD",tag:"BF14"},MESSAGE_CONFIRM_PROTECT_FILE:{type:"MD",tag:"BF15"},MESSAGE_CONFIRM_AGREEMENT:{type:"MD",tag:"BF16"},MESSAGE_PG_BG_PAYMENT:{type:"MD",tag:"BF17"},MESSAGE_NEW_BENEFICIARY:{type:"MD",tag:"BF18"},MESSAGE_LOGIN:{type:"MD",tag:"BF19"},MESSAGE_PAYMENT:{type:"MD",tag:"BF1A"},MESSAGE_TRANSFER:{type:"MD",tag:"BF1B"},MESSAGE_SIGNING:{type:"MD",tag:"BF1C"},MESSAGE_AUTHENTICATE:{type:"MD",tag:"BF1D"},MESSAGE_CONFIRM_ASSIGNMENT:{type:"MD",tag:"BF1E"},MESSAGE_CONFIRM_ADDRESS_CHANGE:{type:"MD",tag:"BF1F"},FREE_TEXT:{type:"E0",tag:"E0"},HIDDEN_TEXT:{type:"E1",tag:"E1",min_length:1,max_length:127}},templates:{0:[["INPUT_FURTHER_INPUTS"],["SIGN","BUY","LOGIN"]],1:[["INPUT_USER_ID"],["LOGIN"]],2:[["INPUT_PASSCODE"],["LOGIN"]],3:[["INPUT_IDENTITY_NUMBER"],["LOGIN","SIGN"]],4:[["INPUT_EXTRA_CODE"],["LOGIN","SIGN","BUY"]],5:[["INPUT_REFERENCE_NUMBER"],["LOGIN","SIGN","BUY"]],6:[["INPUT_DATA"],["LOGIN","SIGN","BUY"]],7:[["MESSAGE_NEW_BENEFICIARY","INPUT_ACCOUNT_NUMBER"],["SIGN"]],8:[["MESSAGE_NEW_PHONE_NUMBER","INPUT_PHONE_NUMBER"],["SIGN","BUY"]],9:[["INPUT_AMOUNT"],["SIGN","BUY"]],10:[["INPUT_TO_ACCOUNT","INPUT_AMOUNT"],["SIGN"]],11:[["MESSAGE_NEW_BENEFICIARY"],["SIGN"]],12:[["MESSAGE_CONFIRM_ADDRESS_CHANGE"],["SIGN"]],13:[["INPUT_CURRENCY","INPUT_AMOUNT_WITH_CURRENCY"],["SIGN","BUY"]],14:[["INPUT_NUMBER_OF_PAYMENTS","INPUT_TOTAL_AMOUNT"],["SIGN"]],15:[["MESSAGE_INTERNATIONAL_PAYMENT","INPUT_IBAN","INPUT_CURRENCY","INPUT_AMOUNT_WITH_CURRENCY"],["SIGN"]],16:[["MESSAGE_CONFIRM_AGREEMENT","INPUT_REFERENCE_NUMBER","INPUT_DATE"],["SIGN","BUY"]],17:[["MESSAGE_CONFIRM_PROTECT_FILE","INPUT_CHECKSUM"],["SIGN"]],18:[["MESSAGE_CONFIRM_PROTECT_FILE","INPUT_CHECKSUM","INPUT_TOTAL_AMOUNT"],["SIGN"]],19:[["MESSAGE_BUY_SELL_SHARES","INPUT_BUY_SELL","INPUT_AMOUNT"],["SIGN"]],20:[["MESSAGE_BUY_SELL_SHARES","INPUT_BUY_SELL","INPUT_QUANTITY"],["SIGN"]],21:[["MESSAGE_BUY_SELL_SHARES","INPUT_BUY_SELL","INPUT_QUANTITY","INPUT_LIMIT","INPUT_TO_DATE"],["SIGN"]],22:[["INPUT_ACCOUNT_NUMBER"],["SIGN"]],23:[["MESSAGE_PG_BG_PAYMENT","INPUT_ACCOUNT_NUMBER","INPUT_REFERENCE_NUMBER","INPUT_AMOUNT"],["SIGN"]]}},T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,$=!0,_=null,ab=null;return O[6283]="The Card holder Authentication Application is blocked",O[6330]="More than 10 AIDs available for the selected authentication mode",O["63C0"]="No PIN tries remaining",O["63C1"]="PIN authentication failed. 1 try remaining",O["63C2"]="PIN authentication failed. 2 tries remaining",O["63C3"]="PIN authentication failed. 3 No PIN tries remaining",O["63C4"]="PIN authentication failed. 4 No PIN tries remaining",O["63C5"]="PIN authentication failed. 5 No PIN tries remaining",O["63C6"]="PIN authentication failed. 6 No PIN tries remaining",O["63C7"]="PIN authentication failed. 7 No PIN tries remaining",O["63C8"]="PIN authentication failed. 8 No PIN tries remaining",O["63C9"]="PIN authentication failed. 9 No PIN tries remaining",O["63CA"]="PIN authentication failed. 10 No PIN tries remaining",O["63CB"]="PIN authentication failed. 11 No PIN tries remaining",O["63CC"]="PIN authentication failed. 12 No PIN tries remaining",O["63CD"]="PIN authentication failed. 13 No PIN tries remaining",O["63CE"]="PIN authentication failed. 14 No PIN tries remaining",O["63CF"]="PIN authentication failed. 15 No PIN tries remaining",O[6400]="Operation aborted after time-out",O[6401]="Operation aborted by end-user",O[6521]="Secure Channel Establishment Not able to generate a CAP Token",O[6531]="Secure Channel Establishment Not able to generate AC",O[6532]="Secure Channel Establishment Not able to generate AC",O[6533]="Secure Channel Establishment Not able to generate AC",O[6534]="Secure Channel Establishment Not able to generate AC",O[6535]="Secure Channel Establishment Not able to generate AC",O[6536]="Secure Channel Establishment Not able to generate AC",O[6537]="Secure Channel Establishment Not able to generate AC",O[6538]="Secure Channel Establishment Not able to generate AC",O[6539]="Secure Channel Establishment Not able to generate AC",O["653A"]="Secure Channel Establishment Not able to generate AC",O["653B"]="Secure Channel Establishment Not able to generate AC",O["653C"]="Secure Channel Establishment Not able to generate AC",O["653D"]="Secure Channel Establishment Not able to generate AC",O["653E"]="Secure Channel Establishment Not able to generate AC",O["653F"]="Secure Channel Establishment Not able to generate AC",O[6541]="Secure Channel Card Error (Communication Error, No Card response)",O[6550]="If Off-line PIN is supported, no PIN entered or card holder pressed cancel",O[6551]="No PIN entered (time-out) or card holder pressed cancel",O[6552]="Time-out no card inserted or card holder pressed cancel",O[6553]="No card holder approval or card holder pressed cancel",O[6554]="No card available (Wait Card Indicator)",O[6555]="Operation aborted by Card Removal",O[6560]="Secure Channel User Input Timer",O[6610]="Secure Channel CTRU Exceeded (SW_CTRU_Exceeded)",O[6611]="Secure Channel CTRE Exceeded (SW_CTRE_Exceeded)",O[6612]="Secure Channel Time-out",O[6613]="Secure Channel MAC Generation Error",O[6614]="Secure Channel Problem with Encryption",O[6615]="Secure Channel Problem with Decryption (SW_DEC_Error)",O[6620]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6621]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6622]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6623]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6624]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6625]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6626]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6627]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6628]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6629]="Secure Channel MAC Validation Error (SW_MAC_Error)",O["662A"]="Secure Channel MAC Validation Error (SW_MAC_Error)",O["662B"]="Secure Channel MAC Validation Error (SW_MAC_Error)",O["662C"]="Secure Channel MAC Validation Error (SW_MAC_Error)",O["662D"]="Secure Channel MAC Validation Error (SW_MAC_Error)",O["662E"]="Secure Channel MAC Validation Error (SW_MAC_Error)",O["662F"]="Secure Channel MAC Validation Error (SW_MAC_Error)",O[6700]="Corrupt input data (incorrect length)",O[6710]="Secure Channel required/requested but not specified in CLA",O[6711]="Secure Channel required/requested but not enabled",O[6712]="Secure Channel Encryption required but not enabled",O[6713]="Secure Channel already enabled",O[6720]="Invalid Passcode Configuration",O[6721]="Secure Channel Option (or optional feature) not supported",O[6722]="Secure Channel Character Set not supported",O[6723]="Secure Channel Issuer Text size error",O[6724]="Secure Channel Invalid Frame Information",O["69F0"]="Command not allowed PIN entry cancelled (Command Filtering)",O["69F1"]="The card holder switched off or disconnected the PCR",O[6987]="Missing data element (Mandatory)",O[6988]="Missing data element (Optional IAF Amount, currency)",O["69F2"]="Transaction operation stopped by reader (Missing mandatory card data)",O["69F3"]="Transaction operation stopped by reader (Duplicate data elements)",O["69F4"]="Transaction operation stopped by reader (Pb with display of TDS)",O["69F5"]="No (EMV) Chip Card inserted in PCR, but card presence required",O[6982]="Command not allowed Security status not satisfied",O[6983]="PIN Blocked",O[6984]="PIN Blocked",O["6A81"]="The card does not support SELECT by Name",O["6A82"]="No Card holder Authentication application from the PCR Application Selection List is present on the card",O["6A83"]="Record not found",O["6A86"]="Invalid P1 or P2 value",O["6B80"]="Invalid P1 or P2 value",O["6D00"]="Bad INS",O["6E00"]="Bad CLA",O["6F00"]="Undetermined error. Unexpected card response or data",O[9804]="Invalid PIN on non-EMV card",P[80100001]="An internal consistency check failed.",P[80100002]="The action was cancelled by an SCardCancel request.",P[80100003]="The supplied handle was invalid.",P[80100004]="One or more of the supplied parameters could not be properly interpreted.",P[80100005]="Registry startup information is missing or invalid.",P[80100006]="Not enough memory available to complete this command.",P[80100007]="An internal consistency timer has expired.",P[80100008]="The data buffer to receive returned data is too small for the returned data.",P[80100009]="The specified reader name is not recognized.",P["8010000A"]="The user-specified timeout value has expired.",P["8010000B"]="The smart card cannot be accessed because of other connections outstanding.",P["8010000C"]="The operation requires a Smart Card, but no Smart Card is currently in the device.",P["8010000D"]="The specified smart card name is not recognized.",P["8010000E"]="The system could not dispose of the media in the requested manner.",P["8010000F"]="The requested protocols are incompatible with the protocol currently in use with the smart card.",P[80100010]="The reader or smart card is not ready to accept commands.",P[80100011]="One or more of the supplied parameters values could not be properly interpreted.",P[80100012]="The action was cancelled by the system, presumably to log off or shut down.",P[80100013]="An internal communications error has been detected.",P[80100014]="An internal error has been detected, but the source is unknown.",P[80100015]="An ATR obtained from the registry is not a valid ATR string.",P[80100016]="An attempt was made to end a non-existent transaction.",P[80100017]="The specified reader is not currently available for use.",P[80100018]="The operation has been aborted to allow the server application to exit.",P[80100019]="The PCI Receive buffer was too small.",P["8010001A"]="The reader driver does not meet minimal requirements for support.",P["8010001B"]="The reader driver did not produce a unique reader name.",P["8010001C"]="The smart card does not meet minimal requirements for support.",P["8010001D"]="The Smart card resource manager is not running.",P["8010001E"]="The Smart card resource manager has shut down.",P["8010001F"]="An unexpected card error has occurred.",P[80100020]="No Primary Provider can be found for the smart card.",P[80100021]="The requested order of object creation is not supported.",P[80100022]="This smart card does not support the requested feature.",P[80100023]="The identified directory does not exist in the smart card.",P[80100024]="The identified file does not exist in the smart card.",P[80100025]="The supplied path does not represent a smart card directory.",P[80100026]="The supplied path does not represent a smart card file.",P[80100027]="Access is denied to this file.",P[80100028]="The smartcard does not have enough memory to store the information.",P[80100029]="There was an error trying to set the smart card file object pointer.",P["8010002A"]="The supplied PIN is incorrect.",P["8010002B"]="An unrecognized error code was returned from a layered component.",P["8010002C"]="The requested certificate does not exist.",P["8010002D"]="The requested certificate could not be obtained.",P["8010002E"]="Cannot find a smart card reader.",P["8010002F"]="A communications error with the smart card has been detected.Retry the operation.",P[80100030]="The requested key container does not exist on the smart card.",P[80100031]="The Smart card resource manager is too busy to complete this operation.",P[80100065]="The reader cannot communicate with the card, due to ATR string configuration conflicts.",P[80100066]="The smart card is not responding to a reset.",P[80100067]="Power has been removed from the smart card, so that further communication is not possible.",P[80100068]="The smart card has been reset, so any shared state information is invalid.",P[80100069]="The smart card has been removed, so further communication is not possible.",P["8010006A"]="Access was denied because of a security violation.",P["8010006B"]="The card cannot be accessed because the wrong PIN was presented.",P["8010006C"]="The card cannot be accessed because the maximum number of PIN entry attempts has been reached.",P["8010006D"]="The end of the smart card file has been reached.",P["8010006E"]="The action was canceled by the user.",P["8010006F"]="No PIN was presented to the Smart card.",H.getVersion=a,H.isSmartcardServiceAvailable=m,H.getSConnectVersion=o,H.Connection=q,F={error:function(a){LoggingService.error("HardwareEventHandler - ("+a+")")},onCardInsertion:function(a){LoggingService.debug("onCardInsertion - (BEGIN)"),LoggingService.info("onCardInsertion - Reader name ("+a.readerName+") - Card ATR ("+a.ATR+")");var c=!0,e="";if(Q&&"function"==typeof Q&&(c=Q(a.readerName,a.ATR)),!c)return void LoggingService.warning("onCardInsertion - Reader or smart card rejected by the Hardware Filter !");V&&V("CARD_IN",a.readerName,a.ATR),b();try{Y=a.readerName,Z=a.ATR,r(a.readerName,a.ATR)}catch(g){b(),e=g.message||f("PcscError"),d(e)}LoggingService.debug("onCardInsertion - (END)")},onCardInsertionMute:function(a){LoggingService.debug("onCardInsertionMute - (BEGIN)"),LoggingService.error("onCardInsertionMute - Reader name ("+a.readerName+")"),V&&V("CARD_MUTE",a.readerName),LoggingService.debug("onCardInsertionMute - (END)")},onCardRemoval:function(a){LoggingService.debug("onCardRemoval - (BEGIN)"),LoggingService.info("onCardRemoval - Reader name ("+a.readerName+")"),a.readerName===Y&&(b(),Y=null,Z=null,s(a.readerName)),V&&V("CARD_OUT",a.readerName),LoggingService.debug("onCardRemoval - (END)")},onReaderConnected:function(a){LoggingService.debug("onReaderConnected - (BEGIN)"),LoggingService.info("onReaderConnected - Reader name ("+a.readerName+")"),V&&V("READER_IN",a.readerName),LoggingService.debug("onReaderConnected - (END)")
},onReaderDisconnected:function(a){LoggingService.debug("onReaderDisconnected - (BEGIN)"),LoggingService.info("onReaderDisconnected - Reader name ("+a.readerName+")"),a.readerName===Y&&(Y=null,Z=null,b()),V&&V("READER_OUT",a.readerName),LoggingService.debug("onReaderDisconnected - (END)")}},H.dispose=t,E={success:function(){LoggingService.debug("installAddOnsCallback.success");try{SConnect.PCSC.RegisterCardIRHandler(F),null!==_&&void 0!==typeof _&&j(_)}catch(a){i(_,f("PcscError"))}},error:function(a,b){LoggingService.error("installAddOnsCallback.error - code ("+a+") - info ("+b+")"),null!==_&&void 0!==typeof _&&i(_,a)}},G={success:function(){LoggingService.debug("validateCallback.success"),SConnect.InstallAddOns([new SConnect.PCSCInfo],E,!$)},error:function(a){LoggingService.error("validateCallback.error - code ("+a+")"),W&&W(a)}},H.init=u,H.getConnection=v,H.reConnection=w,H.list_readers=x,H.getTrackingInformation=y,H.get_file_from_server=z,H.is_installed=A,H.validate_installation=B,H.getBrowserCaracteristics=C,H.isBrowserSupported=D,H}();enex.BROWSER_NAME="BrowserName",enex.BROWSER_VERSION="BrowserVersion",enex.OPERATING_SYSTEM="OS",enex.PersonalCardReaderName="PersonalCardReaderName",enex.PersonalCardReaderInformation="PersonalCardReaderInformation",enex.SmartCardATR="SmartCardATR",enex.SmartCardPersonalAccountNumber="SmartCardPersonalAccountNumber",enex.SmartCardPersonalAccountNumberSequenceNumber="SmartCardPersonalAccountNumberSequenceNumber",enex.SmartCardExpirationDate="SmartCardExpirationDate",enex.FEATURE_VERIFY_PIN_DIRECT="06",enex.FEATURE_MODIFY_PIN_DIRECT="07",enex.FEATURE_CCID_ESC_COMMAND="13",enex.FEATURE_PARAMETER_TIMEOUT="bTimeOut",enex.FEATURE_PARAMETER_TIMEOUT2="bTimeOut2",enex.FEATURE_PARAMETER_FORMATSTRING="bmFormatString",enex.FEATURE_PARAMETER_PINBLOCKSTRING="bmPINBlockString",enex.FEATURE_PARAMETER_PINLENGTHFORMAT="bmPINLengthFormat",enex.FEATURE_PARAMETER_PINMAXEXTRADIGIT="wPINMaxExtraDigit",enex.FEATURE_PARAMETER_ENTRYVALIDATIONCONDITION="bEntryValidationCondition",enex.FEATURE_PARAMETER_NUMBERMESSAGE="bNumberMessage",enex.FEATURE_PARAMETER_LANGID="wLangId",enex.FEATURE_PARAMETER_MSGINDEX="bMsgIndex",enex.FEATURE_PARAMETER_TEOPROTOCOL="bTeoPrologue",enex.FEATURE_PARAMETER_DATALENGTH="ulDataLength",enex.FEATURE_PARAMETER_DATA="abData",enex.FEATURE_PARAMETER_INSERTIONOFFSETOLD="bInsertionOffsetOld",enex.FEATURE_PARAMETER_INSERTIONOFFSETNEW="bInsertionOffsetNew",enex.FEATURE_PARAMETER_CONFIRMPIN="bConfirmPIN",enex.FEATURE_PARAMETER_MSGINDEX1="bMsgIndex1",enex.FEATURE_PARAMETER_MSGINDEX2="bMsgIndex2",enex.FEATURE_PARAMETER_MSGINDEX3="bMsgIndex3",enex.SWYS_ALGO_GEMALTO="gemalto",enex.SWYS_ALGO_MODE2TDS="mode2tds",enex.SWYS_ALGO_MODE3TDS="mode3tds";