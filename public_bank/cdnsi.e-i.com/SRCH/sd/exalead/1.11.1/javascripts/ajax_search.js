var SRCHAjaxIncluded=true;var SRCH_currentResultSelected=-1;const SRCH_keyboard={UPARROW:38,DOWNARROW:40,TAB:9,ESCAPE:27};function AjaxCallToExalead(a,d,c,g){var h=c||"/fr/search_engine.html";var f=g||"/fr/SearchAjax.html";var b="pQuery";var e=10;a=a.trim();if(a){$.ajax({url:f,type:"GET",data:b+"="+encodeURIComponent(a),success:function(j,i){},error:function(k,i,j){},complete:function(o,j){if(j=="success"){var n=$.parseJSON(o.responseText);var m=n.length>e?e:n.length;var k="";if(m>0){ShowAutocomplete(d);k='<ul id="lstresult" role="listbox" aria-label="Suggestions">'}for(var l=0;l<m;l++){k+='<li role="option" class="srch-search-link" id="SRCH_result_'+l+'">';k+='<a href="'+h+"?"+b+"="+n[l]+"";if(window.eiesp!==undefined&&window.eiesp!=""){k+="&pSpace="+window.eiesp}k+='">'+n[l]+"</a></li>"}if(m>0){k+="</ul>"}else{HideAutocomplete(d);$(d+" .autocomplete_search").empty()}$(d+" .autocomplete_search").html(k)}}})}else{HideAutocomplete(d);$(d+" .autocomplete_search").empty()}}var delaySRCHSearch=(function(){var a=0;return function(c,b){clearTimeout(a);a=setTimeout(c,b)}})();$(document).ready(function(){var e=null;var a=false;var b=null;if(typeof getEspace!=="undefined"&&$.isFunction(getEspace)){e=getEspace()}if(e){window.eiesp=e;var c='<input type="hidden" name="pSpace" value="'+window.eiesp+'" />';$(".CMSD_search").append(c)}$(".CMSD_search").on("click",".srch-search-link a",function(h){try{h.preventDefault();var f=this.text;RechercheDirecteAjaxCall(f,this)}catch(g){document.location=this.href}});$(".CMSD_search").on("mousedown",".srch-search-link a",function(f){a=true});$(".CMSD_search").submit(function(j){try{j.preventDefault();var i=this;if(SRCH_currentResultSelected>-1){var g=$(this).find(".srch-search-link a");RechercheDirecteAjaxCall(g[SRCH_currentResultSelected].text,g[SRCH_currentResultSelected])}else{var f=this[(name="pQuery")].value;RechercheDirecteAjaxCall(f,i)}}catch(h){console.log(h);i.submit()}});if(typeof srchConfig!=="undefined"&&srchConfig.searchAjaxUrl&&srchConfig.formUrl){var d=["#SRCH_form_header","#SRCH_form_footer","#SRCH_form_mobile"];d.forEach(function(f){$(f+" .SRCH_input").keyup(function(g){if(b!=g.currentTarget.value){b=g.currentTarget.value;delaySRCHSearch(function(){AjaxCallToExalead(b,f,srchConfig.formUrl,srchConfig.searchAjaxUrl)},300)}});$(f+" .SRCH_input").focus(function(){if($(f+" .srch-search-link").length>0){ShowAutocomplete(f)}return true});$(f+" .SRCH_input").blur(function(){if(!a){HideAutocomplete(f)}a=false;return true});$(f+" .SRCH_input").keydown(function(j){var i=j.keyCode||j.which;if(i===SRCH_keyboard.TAB){if(!j.shiftKey){j.preventDefault();var k=$(f+" .e_image");var h=$(f+" button.ei_srchbar_button");if(k.length){k.focus()}else{if(h){h.focus()}}}return}if(i!==SRCH_keyboard.UPARROW&&i!==SRCH_keyboard.DOWNARROW&&i!==SRCH_keyboard.ESCAPE){return}var g=$(f+" .srch-search-link").length;if(g==0){return}if(i===SRCH_keyboard.UPARROW){j.preventDefault();if(--SRCH_currentResultSelected==-2){SRCH_currentResultSelected=g-1}AriaSelected(f,SRCH_currentResultSelected)}else{if(i===SRCH_keyboard.DOWNARROW){if(++SRCH_currentResultSelected==g){SRCH_currentResultSelected=-1}AriaSelected(f,SRCH_currentResultSelected)}else{if(i===SRCH_keyboard.ESCAPE){HideAutocomplete(f)}}}})})}});function UnSelectAutocompleteResults(a){$(a+" .srch-search-link").removeClass("ei_search-focus").removeAttr("aria-selected")}function ShowAutocomplete(a){$(a+" .SRCH_input").attr("aria-expanded","true");$(a+" .autocomplete_search").show()}function HideAutocomplete(a){SRCH_currentResultSelected=-1;$(a+" .SRCH_input").attr("aria-expanded","false");$(a+" .SRCH_input").removeAttr("aria-activedescendant");UnSelectAutocompleteResults(a);$(a+" .autocomplete_search").hide()}function AriaSelected(a){if(!$(a+" .autocomplete_search").is(":visible")){ShowAutocomplete(a)}UnSelectAutocompleteResults(a);if(SRCH_currentResultSelected==-1){$(a+" .SRCH_input").removeAttr("aria-activedescendant")}else{$(a+" #SRCH_result_"+SRCH_currentResultSelected).attr("aria-selected","true").addClass("ei_search-focus");$(a+" .SRCH_input").attr("aria-activedescendant","SRCH_result_"+SRCH_currentResultSelected)}}function RechercheDirecteAjaxCall(b,d){b=SanitizeQuery(b);var c=true;var a=false;if(typeof urlRedirect!=="undefined"){a=urlRedirect}if(typeof srchConfig!=="undefined"&&srchConfig.redirectUrl){a=srchConfig.redirectUrl}if(!a||!b){if(typeof d=="function"){d()}else{if(d.tagName=="FORM"){d.submit()}else{if(d.tagName=="A"){document.location=d.href}}}return}$.ajax({url:a,type:"GET",data:"pQuery="+encodeURIComponent(b),success:function(f){var e=$.parseJSON(f);if(e&&e.url){c=false;RechercheDirecteStat(b);window.location=e.url}else{if(e&&e.js){c=false;RechercheDirecteStat(b);OuvrirEspaceConseiller(e.js,d)}}},error:function(){},complete:function(){if(c===false){return false}if(!d){return true}if(typeof d=="function"){d()}else{if(d.tagName=="FORM"){d.submit()}else{if(d.tagName=="A"){setTimeout(function(){document.location.href=d.href},0)}}}}})}function OuvrirEspaceConseiller(c,b){if(typeof EspaceConseiller!=="undefined"&&c){var a={};a.context="";a.tab=c;EspaceConseiller.OpenBlocConseiller(a);var d=$(b).closest("form");if(b&&d){HideAutocomplete("#"+d.attr("id"))}}}function RechercheDirecteStat(a){if(typeof dataLayer!="undefined"){dataLayer.push({event:"RechercheDirecte",eventAction:"resultat affiche",eventLabel:a,espaceRecherche:"tous"})}}function SanitizeQuery(b){var a=b.toLowerCase();a=a.replace(/\s+/g," ");a=a.trim();return a};